<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Christoph Maureder Portfolio</title>
  <link rel="stylesheet" href="style.css">
  <meta name="description" content="Game design portfolio highlighting design work with coding capability.">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="brand">
        <svg class="pacman" viewBox="0 0 100 100" aria-hidden="true">
          <circle cx="50" cy="50" r="48" fill="currentColor"></circle>
          <polygon points="50,50 100,25 100,75" fill="var(--bg)"></polygon>
        </svg>
        <span>hristoph Maureder</span>
      </h1>
      <p class="tagline">Character & Systems Designer · Designer Who Codes · Curious Human</p>
      <div class="controls">
        <div id="tagbar" class="tagbar" aria-label="Filter by tag"></div>
      </div>
    </div>
  </header>

  <main class="container">
    <section aria-labelledby="overview-title">
      <h2 id="overview-title" class="visually-hidden">Project Overview</h2>
      <div id="projects" class="grid"></div>
    </section>
  </main>

  <section class="contact-cta" aria-labelledby="contact-title">
    <div class="container">
      <h2 id="contact-title">Want to know more? Let’s chat!</h2>
      <div class="cta-row">
        <a class="btn" href="https://www.linkedin.com/in/christoph-maureder" target="_blank" rel="noopener">LinkedIn</a>
        <a class="btn js-copy-email" href="#" data-email="maureder.christoph@gmail.com">Copy Email!</a>
      </div>
    </div>
  </section>

  <footer class="site-footer">
    <div class="container">
      <p>© <span id="year"></span> Christoph Maureder</p>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    async function loadProjects() {
      const res = await fetch('projects.json');
      if (!res.ok) throw new Error('Failed to load projects.json');
      return await res.json();
    }

    function renderCards(projects) {
      const grid = document.getElementById('projects');
      grid.innerHTML = '';
      for (const p of projects) {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <a class="card-link" href="project.html?slug=${encodeURIComponent(p.slug)}" aria-label="Open ${p.title}">
            <div class="thumb">
              <img loading="lazy" src="${p.coverImage || 'assets/placeholder.svg'}" alt="${p.title} cover">
            </div>
            <div class="card-body">
              <h3 class="card-title">${p.title}</h3>
              <p class="muted">${p.subtitle || ''}</p>
              <ul class="meta">
                ${p.year ? `<li>${p.year}</li>` : ''}
                ${p.teamSize ? `<li>${p.teamSize} ${p.teamSize === 1 ? 'person' : 'people'}</li>` : ''}
                ${p.duration ? `<li>${p.duration}</li>` : ''}
                ${p.role ? `<li>${p.role}</li>` : ''}
              </ul>
              <p class="desc">${p.shortDescription || ''}</p>
              <div class="tags">
                ${(p.tags || []).map(t => `<span class="tag" data-tag="${t}">${t}</span>`).join('')}
              </div>
              <p class="view-more">View details →</p>
            </div>
          </a>
        `;
        grid.appendChild(card);
        card.addEventListener('click', (e) => {
          const a = card.querySelector('a.card-link');
          if (!a) return;
          if (!e.target.closest('a')) window.location.href = a.getAttribute('href');
        });
      }
    }

    function collectAllTags(projects) {
      const set = new Set();
      projects.forEach(p => (p.tags || []).forEach(t => set.add(t)));
      return Array.from(set).sort((a,b)=>a.localeCompare(b));
    }

    function renderTagbar(tags) {
      const bar = document.getElementById('tagbar');
      bar.innerHTML = '';
      const all = document.createElement('button');
      all.className = 'chip is-active';
      all.textContent = 'All';
      all.dataset.tag = '';
      bar.appendChild(all);
      tags.forEach(tag => {
        const btn = document.createElement('button');
        btn.className = 'chip';
        btn.textContent = tag;
        btn.dataset.tag = tag;
        bar.appendChild(btn);
      });
      bar.addEventListener('click', e => {
        if (e.target.matches('.chip')) {
          bar.querySelectorAll('.chip').forEach(c => c.classList.remove('is-active'));
          e.target.classList.add('is-active');
          applyFilters();
        }
      });
    }

    function applyFilters() {
      const activeChip = document.querySelector('.chip.is-active');
      const tag = activeChip ? activeChip.dataset.tag : '';
      const filtered = window.__ALL_PROJECTS__.filter(p => {
        const matchesTag = !tag || (p.tags || []).includes(tag);
        return matchesTag;
      });
      renderCards(filtered);
    }

    function attachCopyEmail() {
      const buttons = document.querySelectorAll('.js-copy-email');
      buttons.forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          const email = btn.dataset.email || 'maureder.christoph@gmail.com';
          try {
            await navigator.clipboard.writeText(email);
          } catch (err) {
            const ta = document.createElement('textarea');
            ta.value = email; document.body.appendChild(ta);
            ta.select(); document.execCommand('copy'); ta.remove();
          }
          showCopyToast(btn, 'Copied! 👍');
        });
      });
    }

    function showCopyToast(anchor, text) {
      const toast = document.createElement('div');
      toast.className = 'copy-pop';
      toast.textContent = text;
      document.body.appendChild(toast);
      const r = anchor.getBoundingClientRect();
      toast.style.left = (r.left + r.width/2) + 'px';
      toast.style.top  = (r.top - 8) + 'px';
      requestAnimationFrame(() => toast.classList.add('is-visible'));
      setTimeout(() => {
        toast.classList.remove('is-visible');
        setTimeout(() => toast.remove(), 200);
      }, 1200);
    }

    (async function init() {
      try {
        const projects = await loadProjects();
        window.__ALL_PROJECTS__ = projects;
        renderTagbar(collectAllTags(projects));
        renderCards(projects);
        attachCopyEmail();
      } catch (err) {
        document.getElementById('projects').innerHTML = '<p>Could not load projects. Make sure you are serving the site over HTTP.</p>';
        console.error(err);
      }
    })();
  </script>
</body>
</html>
